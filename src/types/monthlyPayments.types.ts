// src/types/monthlyPayments.types.ts
// ğŸ“ TIPOS SIMPLIFICADOS PARA PAGOS MENSUALES
// ğŸ¯ Reglas de negocio: Vence el 15, precio variable, suspensiÃ³n no devuelve pagos

/**
 * ğŸ’³ PAGO MENSUAL INDIVIDUAL
 * Representa un cargo mensual especÃ­fico para una actividad
 */
export interface MonthlyPayment {
  id?: string;
  
  // ğŸ‘¤ IdentificaciÃ³n
  memberId: string;
  memberName: string;
  
  // ğŸƒ Actividad/MembresÃ­a
  membershipId: string;      // ID de la membresÃ­a permanente
  activityId: string;
  activityName: string;
  
  // ğŸ“… PerÃ­odo (mes especÃ­fico)
  month: string;             // Formato: "YYYY-MM" (ej: "2025-10")
  dueDate: string;           // Siempre "YYYY-MM-15" (dÃ­a 15)
  
  // ğŸ’° Montos
  amount: number;            // Precio del mes (puede cambiar mes a mes)
  
  // âœ… Estado
  status: 'pending' | 'paid' | 'overdue';
  
  // ğŸ“ Registro de pago (cuando se paga)
  paidAt?: any;              // Firebase Timestamp
  paidDate?: string;         // YYYY-MM-DD
  transactionId?: string;    // Link a la transacciÃ³n
  
  // ğŸ¤– Metadata
  generatedAt: any;          // Firebase Timestamp - cuÃ¡ndo se creÃ³
  autoGenerated: boolean;    // true = creado automÃ¡ticamente
  createdBy?: string;        // Usuario que lo creÃ³ (si manual)
}

/**
 * ğŸ’¼ MEMBRESÃA (RelaciÃ³n permanente socio-actividad)
 * Esta NO se renueva, es permanente hasta que se suspenda
 */
export interface MembershipStatus {
  id?: string;
  
  // ğŸ‘¤ Socio
  memberId: string;
  memberName: string;
  
  // ğŸƒ Actividad
  activityId: string;
  activityName: string;
  
  // ğŸ“… Fechas
  startDate: string;         // YYYY-MM-DD - cuÃ¡ndo se dio de alta
  
  // âœ… Estado
  status: 'active' | 'suspended';
  
  // ğŸ¤– Auto-generaciÃ³n de pagos
  autoGeneratePayments: boolean;  // true por defecto
  
  // ğŸ“ Metadata
  createdAt: any;            // Firebase Timestamp
  updatedAt?: any;           // Firebase Timestamp
  suspendedAt?: any;         // CuÃ¡ndo se suspendiÃ³ (si aplica)
  suspendedReason?: string;  // Motivo de suspensiÃ³n
}

/**
 * ğŸ“Š RESUMEN MENSUAL
 * EstadÃ­sticas agregadas de un mes especÃ­fico
 */
export interface MonthlySummary {
  year: number;
  month: number;              // 1-12
  
  // ğŸ“ˆ Totales
  totalMembers: number;       // Socios con pagos este mes
  totalToCollect: number;     // Total a cobrar
  totalCollected: number;     // Total cobrado
  totalPending: number;       // Total pendiente
  
  // ğŸ‘¥ Socios
  membersWithDebt: number;    // CuÃ¡ntos deben
  membersUpToDate: number;    // CuÃ¡ntos estÃ¡n al dÃ­a
  
  // ğŸƒ Por actividad
  activitiesBreakdown: {
    [activityName: string]: {
      members: number;
      totalCost: number;
      collected: number;
      pending: number;
    };
  };
}

/**
 * ğŸ“‹ ITEM DE LISTA (Para el dashboard)
 * Vista resumida de un socio y sus pagos pendientes
 */
export interface MonthlyPaymentListItem {
  memberId: string;
  memberName: string;
  memberEmail?: string;
  totalPending: number;
  activitiesPendingCount: number;
  isOverdue: boolean;
  daysOverdue: number;
  pendingActivities: {  // â† Se llama pendingActivities, NO activities
    paymentId: string;
    membershipId: string;
    activityName: string;
    amount: number;
    dueDate: string;
    status: 'pending' | 'overdue';
  }[];
}

/**
 * âš™ï¸ CONFIGURACIÃ“N DE AUTOMATIZACIÃ“N
 * Reglas para generar pagos automÃ¡ticamente
 */
export interface AutoGenerationConfig {
  enabled: boolean;
  
  // ğŸ“… NO usar dÃ­a del mes, siempre es el 15
  // Solo verificar si ya se generÃ³ para este mes
  lastProcessedMonth?: string;  // "YYYY-MM"
  
  // ğŸ”§ Opciones
  onlyActiveMembers: boolean;        // Solo socios activos
  onlySuspendedMemberships: boolean; // Excluir membresÃ­as suspendidas
}

/**
 * ğŸ’³ MÃ‰TODO DE PAGO
 */
export type PaymentMethod = 'cash' | 'transfer' | 'card' | 'mercadopago';

/**
 * ğŸ“ RESULTADO DE OPERACIÃ“N
 */
export interface OperationResult {
  success: boolean;
  message?: string;
  error?: string;
  data?: any;
}

/**
 * ğŸ¤– RESULTADO DE AUTO-GENERACIÃ“N
 */
export interface AutoGenerationResult {
  success: boolean;
  paymentsGenerated: number;
  errors: string[];
  summary: {
    totalMembers: number;
    totalMemberships: number;
    totalAmount: number;
    skipped: {
      suspended: number;
      alreadyExists: number;
    };
  };
}